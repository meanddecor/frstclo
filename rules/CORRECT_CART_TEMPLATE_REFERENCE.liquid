{% comment %}
  ============================================================
  REFERENCE: Correct Cart Items Section Structure
  ============================================================
  
  This file shows how main-cart-items.liquid SHOULD be structured
  to use Shopify's dynamic cart object instead of static HTML.
  
  DO NOT use this file directly - it's a reference/guide.
  Use this to understand the correct pattern for cart rendering.
  ============================================================
{% endcomment %}

<cart-items class="gradient isolate">
  <div class="page-width">
    
    {%- comment -%} Cart Header {%- endcomment -%}
    <div class="title-wrapper-with-link">
      <h1 class="title title--primary">{{ 'sections.cart.title' | t }}</h1>
      <a href="{{ routes.all_products_collection_url }}" class="underlined-link">
        {{ 'general.continue_shopping' | t }}
      </a>
    </div>

    {%- comment -%} Empty Cart Message {%- endcomment -%}
    {% if cart.item_count == 0 %}
      <div class="cart__warnings">
        <h1 class="cart__empty-text">{{ 'sections.cart.empty' | t }}</h1>
        <a href="{{ routes.all_products_collection_url }}" class="button">
          {{ 'general.continue_shopping' | t }}
        </a>
      </div>
    {% endif %}

    {%- comment -%} Cart Form - Only show if cart has items {%- endcomment -%}
    {% if cart.item_count > 0 %}
      <form action="{{ routes.cart_url }}" class="cart__contents" method="post" id="cart">
        
        <div class="cart__items" id="main-cart-items" data-id="{{ section.id }}">
          <div class="js-contents">
            
            <table class="cart-items">
              <caption class="visually-hidden">{{ 'sections.cart.title' | t }}</caption>
              
              {%- comment -%} Table Header {%- endcomment -%}
              <thead>
                <tr>
                  <th class="caption-with-letter-spacing" colspan="2" scope="col">
                    {{ 'sections.cart.headings.product' | t }}
                  </th>
                  <th class="medium-hide large-up-hide right caption-with-letter-spacing" colspan="1" scope="col">
                    {{ 'sections.cart.headings.total' | t }}
                  </th>
                  <th class="cart-items__heading--wide small-hide caption-with-letter-spacing" colspan="1" scope="col">
                    {{ 'sections.cart.headings.quantity' | t }}
                  </th>
                  <th class="small-hide right caption-with-letter-spacing" colspan="1" scope="col">
                    {{ 'sections.cart.headings.total' | t }}
                  </th>
                </tr>
              </thead>

              {%- comment -%} 
                ⚠️ CRITICAL: This is where the loop should be ⚠️
                NOT static HTML with hardcoded product data!
              {%- endcomment -%}
              <tbody>
                {% for item in cart.items %}
                  <tr class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
                    
                    {%- comment -%} Product Image {%- endcomment -%}
                    <td class="cart-item__media">
                      {% if item.image %}
                        <a href="{{ item.url }}" class="cart-item__link" aria-hidden="true" tabindex="-1">
                          <div class="cart-item__image-container gradient global-media-settings">
                            <img
                              src="{{ item.image | image_url: width: 300 }}"
                              alt="{{ item.image.alt | escape }}"
                              class="cart-item__image"
                              width="150"
                              height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                              loading="lazy"
                            >
                          </div>
                        </a>
                      {% endif %}
                    </td>

                    {%- comment -%} Product Details {%- endcomment -%}
                    <td class="cart-item__details">
                      <a href="{{ item.url }}" class="cart-item__name h4 break">
                        {{ item.product.title | escape }}
                      </a>

                      {%- comment -%} Price per unit {%- endcomment -%}
                      <div class="product-option">
                        {{ item.final_price | money }}
                      </div>

                      {%- comment -%} Variant options (Size, Color, etc.) {%- endcomment -%}
                      {% unless item.product.has_only_default_variant %}
                        <dl>
                          {% for option in item.options_with_values %}
                            <div class="product-option">
                              <dt>{{ option.name }}:</dt>
                              <dd>{{ option.value }}</dd>
                            </div>
                          {% endfor %}
                        </dl>
                      {% endunless %}

                      {%- comment -%} Item discounts {%- endcomment -%}
                      {% if item.line_level_discount_allocations.size > 0 %}
                        <ul class="discounts list-unstyled" role="list">
                          {% for discount in item.line_level_discount_allocations %}
                            <li class="discounts__discount">
                              {% render 'icon-discount' %}
                              {{ discount.discount_application.title }}
                              (-{{ discount.amount | money }})
                            </li>
                          {% endfor %}
                        </ul>
                      {% endif %}
                    </td>

                    {%- comment -%} Total Price (Mobile) {%- endcomment -%}
                    <td class="cart-item__totals right medium-hide large-up-hide">
                      <div class="loading__spinner hidden">
                        <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66">
                          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                        </svg>
                      </div>
                      
                      <div class="cart-item__price-wrapper">
                        <span class="price price--end">
                          {{ item.final_line_price | money }}
                        </span>
                      </div>
                    </td>

                    {%- comment -%} Quantity Controls {%- endcomment -%}
                    <td class="cart-item__quantity">
                      <quantity-popover>
                        <div class="cart-item__quantity-wrapper quantity-popover-wrapper">
                          <label class="visually-hidden" for="Quantity-{{ item.index | plus: 1 }}">
                            {{ 'products.product.quantity.label' | t }}
                          </label>
                          
                          <div class="quantity-popover-container">
                            <quantity-input class="quantity cart-quantity">
                              {%- comment -%} Decrease Button {%- endcomment -%}
                              <button class="quantity__button" name="minus" type="button">
                                <span class="visually-hidden">
                                  {{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}
                                </span>
                                {% render 'icon-minus' %}
                              </button>
                              
                              {%- comment -%} Quantity Input {%- endcomment -%}
                              <input
                                class="quantity__input"
                                data-quantity-variant-id="{{ item.variant.id }}"
                                type="number"
                                name="updates[]"
                                value="{{ item.quantity }}"
                                data-cart-quantity="{{ cart.item_count }}"
                                min="{{ item.variant.quantity_rule.min }}"
                                {% if item.variant.quantity_rule.max != null %}
                                  max="{{ item.variant.quantity_rule.max }}"
                                {% endif %}
                                step="{{ item.variant.quantity_rule.increment }}"
                                aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                                id="Quantity-{{ item.index | plus: 1 }}"
                                data-index="{{ item.index | plus: 1 }}"
                              >
                              
                              {%- comment -%} Increase Button {%- endcomment -%}
                              <button class="quantity__button" name="plus" type="button">
                                <span class="visually-hidden">
                                  {{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}
                                </span>
                                {% render 'icon-plus' %}
                              </button>
                            </quantity-input>
                          </div>
                          
                          {%- comment -%} Remove Button {%- endcomment -%}
                          <cart-remove-button
                            id="Remove-{{ item.index | plus: 1 }}"
                            data-index="{{ item.index | plus: 1 }}"
                          >
                            <a
                              href="{{ item.url_to_remove }}"
                              class="button button--tertiary"
                              aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}"
                            >
                              {% render 'icon-remove' %}
                            </a>
                          </cart-remove-button>
                        </div>
                        
                        {%- comment -%} Error Display {%- endcomment -%}
                        <div class="cart-item__error" id="Line-item-error-{{ item.index | plus: 1 }}" role="alert">
                          <small class="cart-item__error-text"></small>
                          {% render 'icon-error' %}
                        </div>
                      </quantity-popover>
                    </td>

                    {%- comment -%} Total Price (Desktop) {%- endcomment -%}
                    <td class="cart-item__totals right small-hide">
                      <div class="loading__spinner hidden">
                        <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66">
                          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                        </svg>
                      </div>
                      
                      <div class="cart-item__price-wrapper">
                        {% if item.original_line_price != item.final_line_price %}
                          <span class="cart-item__old-price">
                            {{ item.original_line_price | money }}
                          </span>
                        {% endif %}
                        
                        <span class="price price--end">
                          {{ item.final_line_price | money }}
                        </span>
                      </div>
                    </td>
                    
                  </tr>
                {% endfor %}
              </tbody>
            </table>
            
          </div>
        </div>

        {%- comment -%} Screen Reader Live Region {%- endcomment -%}
        <p class="visually-hidden" id="cart-live-region-text" aria-live="polite" role="status"></p>
        <p class="visually-hidden" id="shopping-cart-line-item-status" aria-live="polite" aria-hidden="true" role="status">
          {{ 'accessibility.loading' | t }}
        </p>
        
      </form>
    {% endif %}

  </div>
</cart-items>

{% comment %}
  ============================================================
  KEY POINTS FOR CART FOOTER (main-cart-footer.liquid):
  ============================================================
{% endcomment %}

{% if cart.item_count > 0 %}
  <div class="cart__footer">
    <div class="cart__blocks">
      
      {%- comment -%} Cart Totals {%- endcomment -%}
      <div class="js-contents">
        
        {%- comment -%} Cart-level Discounts {%- endcomment -%}
        {% if cart.cart_level_discount_applications.size > 0 %}
          <ul class="discounts list-unstyled" role="list">
            {% for discount in cart.cart_level_discount_applications %}
              <li class="discounts__discount discounts__discount--end">
                {% render 'icon-discount' %}
                {{ discount.title }}
                (-{{ discount.total_allocated_amount | money }})
              </li>
            {% endfor %}
          </ul>
        {% endif %}

        {%- comment -%} ⚠️ CRITICAL: Use cart.total_price, NOT hardcoded $150 {%- endcomment -%}
        <div class="totals">
          <h2 class="totals__total">{{ 'sections.cart.subtotal' | t }}</h2>
          <p class="totals__total-value">{{ cart.total_price | money_with_currency }}</p>
        </div>

        <small class="tax-note caption-large rte">
          {{ 'sections.cart.taxes_and_shipping_policy_at_checkout_html' | t: link: section.settings.cart_shipping_policy.url }}
        </small>
      </div>

      {%- comment -%} Checkout Buttons {%- endcomment -%}
      <div class="cart__ctas">
        <button
          type="submit"
          id="checkout"
          class="cart__checkout-button button"
          name="checkout"
          form="cart"
        >
          {{ 'sections.cart.checkout' | t }}
        </button>
      </div>

      {%- comment -%} Dynamic Checkout Buttons (Shop Pay, PayPal, etc.) {%- endcomment -%}
      {% if additional_checkout_buttons %}
        <div class="cart__dynamic-checkout-buttons additional-checkout-buttons">
          {{ content_for_additional_checkout_buttons }}
        </div>
      {% endif %}

    </div>
  </div>
{% endif %}

{% comment %}
  ============================================================
  COMPARISON: What's Wrong vs What's Right
  ============================================================
  
  ❌ WRONG (Static HTML):
  <tr class="cart-item" id="CartItem-1">
    <td class="cart-item__details">
      <a href="/products/elixir-shopify-theme?variant=41754816905329">
        MADE. Shopify Theme V1
      </a>
      <div class="product-option">$150</div>
    </td>
  </tr>
  
  ✅ RIGHT (Dynamic Liquid):
  {% for item in cart.items %}
    <tr class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
      <td class="cart-item__details">
        <a href="{{ item.url }}">
          {{ item.product.title | escape }}
        </a>
        <div class="product-option">{{ item.final_price | money }}</div>
      </td>
    </tr>
  {% endfor %}
  
  ============================================================
  KEY SHOPIFY CART OBJECT PROPERTIES:
  ============================================================
  
  cart.items                    - Array of line items
  cart.item_count              - Total number of items
  cart.total_price             - Total price in cents
  cart.currency                - Currency code (USD, EUR, etc.)
  
  item.product.title           - Product name
  item.variant.title           - Variant name
  item.quantity                - Quantity in cart
  item.final_price             - Price per unit (after discounts)
  item.final_line_price        - Total price for this line (price × quantity)
  item.original_line_price     - Original price before discounts
  item.url                     - Product URL
  item.image                   - Product image object
  item.options_with_values     - Variant options (Size, Color, etc.)
  
  ============================================================
{% endcomment %}
